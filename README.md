# Примитивная база данных

Консольное приложение на Python, имитирующее работу с базой данных. Поддерживает создание таблиц, CRUD-операции (insert, select, update, delete), фильтрацию по условиям и форматированный вывод через PrettyTable.

## Установка

```bash
make install
```

Или напрямую:

```bash
poetry install
```

## Запуск

```bash
make project
```

Или напрямую:

```bash
poetry run project
```

## Управление таблицами

| Команда | Описание |
|---------|----------|
| `create_table <имя> <столбец1:тип> ...` | Создать таблицу (столбец ID добавляется автоматически) |
| `list_tables` | Показать список всех таблиц |
| `drop_table <имя>` | Удалить таблицу (с подтверждением) |
| `info <имя>` | Информация о таблице (столбцы, количество записей) |

Поддерживаемые типы данных: `int`, `str`, `bool`.

## CRUD-операции

| Команда | Описание |
|---------|----------|
| `insert into <таблица> values (<зн1>, <зн2>, ...)` | Добавить запись (ID генерируется автоматически) |
| `select from <таблица>` | Показать все записи |
| `select from <таблица> where <столбец> = <значение>` | Показать записи по условию |
| `update <таблица> set <стб> = <зн> where <стб> = <зн>` | Обновить записи по условию |
| `delete from <таблица> where <столбец> = <значение>` | Удалить записи по условию (с подтверждением) |

Строковые значения указываются в кавычках: `"Sergei"`. Числа и булевы — без: `28`, `true`.

## Общие команды

| Команда | Описание |
|---------|----------|
| `help` | Справочная информация |
| `exit` | Выйти из программы |

## Декораторы и продвинутые механики

Проект использует декораторы для улучшения качества кода:

- **`handle_db_errors`** — централизованная обработка ошибок (FileNotFoundError, KeyError, ValueError) без дублирования try/except в каждой функции.
- **`confirm_action`** — фабрика декораторов, запрашивающая подтверждение перед опасными операциями (`drop_table`, `delete`). Вывод: `Вы уверены, что хотите выполнить "..."? [y/n]:`
- **`log_time`** — замер времени выполнения функций (`insert`, `select`) с помощью `time.monotonic()`.
- **`create_cacher()`** — замыкание для кэширования результатов `select`-запросов. Повторные одинаковые запросы возвращают данные из кэша. Кэш инвалидируется при модификации данных.

### Пример использования

```
>>>Введите команду: create_table users name:str age:int is_active:bool
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int, is_active:bool

>>>Введите команду: insert into users values ("Sergei", 28, true)
Запись с ID=1 успешно добавлена в таблицу "users".
Функция insert_record выполнилась за 0.001 секунд.

>>>Введите команду: select from users where age = 28
+----+--------+-----+-----------+
| ID |  name  | age | is_active |
+----+--------+-----+-----------+
| 1  | Sergei | 28  |    True   |
+----+--------+-----+-----------+
Функция select_records выполнилась за 0.000 секунд.

>>>Введите команду: drop_table users
Вы уверены, что хотите выполнить "удаление таблицы"? [y/n]: y
Таблица "users" успешно удалена.

>>>Введите команду: delete from users where ID = 1
Вы уверены, что хотите выполнить "удаление записей"? [y/n]: n
Операция отменена.
```

## Демонстрация

[![asciicast](https://asciinema.org/a/SGODS6dYfkgGvuOR.svg)](https://asciinema.org/a/SGODS6dYfkgGvuOR)

## Проверка кода

```bash
make lint
```

## Структура проекта

```
project2_Bakoev_Faridun/
├── src/
│   ├── __init__.py
│   └── primitive_db/
│       ├── __init__.py
│       ├── main.py          # Точка входа
│       ├── engine.py        # Игровой цикл и обработка команд
│       ├── core.py          # Логика таблиц и CRUD-операций
│       ├── parser.py        # Парсинг команд (where, set, values)
│       ├── decorators.py    # Декораторы и замыкание для кэширования
│       ├── utils.py         # Работа с файлами (JSON)
│       └── constants.py     # Константы (пути, типы данных)
├── data/                    # Данные таблиц (JSON-файлы)
├── Makefile
├── pyproject.toml
├── poetry.lock
├── README.md
└── .gitignore
```
